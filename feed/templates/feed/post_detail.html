{% extends 'base.html' %}

{% block content %}
<style>
  .custom-card {
    max-width: 600px; /* 카드의 최대 너비 설정 */
    margin: auto; /* 가운데 정렬 */
  }
  .feed-image {
    object-fit: cover; /* 이미지 비율 유지하면서 덮기 */
    max-height: 500px; /* 이미지의 최대 높이 설정 */
  }
  .carousel-item {
    transition: transform 1s ease, opacity 0.5s ease; 
  }
  
</style>
<div class="container mt-5">
    <div class="card custom-card">

      <div class="card-body">
        {% if post.feed_images.all %}
          <div id="carouselExampleControls" class="carousel slide" data-bs-interval="false">
            <div class="carousel-inner">
              {% for image in post.feed_images.all %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                  <img src="{{ image.image.url }}" class="d-block w-100 feed-image" alt="...">
                </div>
              {% endfor %}
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        {% endif %}
        
        <h2><a href="{% url 'feed:view_user' post.user.id %}">{{ post.user.username }}</a></h2>

        <h2>{{ post.title }}</h2>
        <p class="mt-3">{{ post.body_text }}</p>

        <!-- 좋아요 버튼 등 추가 기능 구현 -->
        <a href="{% url 'feed:like_content' post.id %}">좋아요</a>
        수: {{ post.likes.count }}


        
        {% if post.content_type == 'review' and post.product %}
          <hr>
          <h5>제품 리뷰</h5>
          <p>제품명: {{ post.product.name }}</p>
          <p>판매자: {{ post.seller.username }}</p>
        {% endif %}
      </div>
      <div class="card-footer text-muted">
        <p> {{ post.created_at|date:"Y-m-d H:i" }} </p>
      </div>
      <!-- ----------------- 추가------------------------------  -->
    {% for comment in post.comment_set.all %}   <!-- Content의 키값post를 참조받고있는 comment을 _set 객체 다가지고옴 -->
                <div>
                    <p>{{ comment.comment_text }}</p>
                    <p>작성자: {{ comment.user.username }}</p>
                    <p>작성일시: {{ comment.created_at }}</p>
                    <!-- 관리자 혹은 댓글작성자 본인만 댓글 삭제가능 -->
                    {% if request.user == comment.user or request.user.is_staff %}
                        <form action="{% url 'feed:comments_delete' comment.pk %}" method="post">
                        {% csrf_token %}
                        <button type="submit">삭제</button>
                        </form>
                    {% endif %}
                    
                </div>
            {% empty %}
                <p>댓글이 없습니다.</p>
            {% endfor %}
      <form action="{% url 'feed:comments_create' post.id %}" method="post">
        {% csrf_token %}
        {{ commentform }}
        <button type="submit">작성</button>
    </form>
    <!------------------------------------------------- -->
    </div>
</div>
{% endblock %}