{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<style>
  /* ------------------------------- */
.expand-button {
  display: inline-block; /* ë”ë³´ê¸° ë²„íŠ¼ì„ í‘œì‹œí•˜ëŠ” ìŠ¤íƒ€ì¼ */
}

.collapse-button {
  display: none; /* ì ‘ê¸° ë²„íŠ¼ì„ ìˆ¨ê¸°ëŠ” ìŠ¤íƒ€ì¼ */
}
/* ìŠ¤í¬ë¡¤ ë°” ë£¨íŠ¸ì²˜ëŸ¼ ì•ˆë³´ì´ê²Œ í•˜ê¸° ìœ„í•´ì„œ */
.modal-content::-webkit-scrollbar {
  display: none; /* WebKit ë¸Œë¼ìš°ì €(ì˜ˆ: Chrome, Safari)ì˜ ìŠ¤í¬ë¡¤ë°”ë¥¼ ìˆ¨ê¹€ */
}
/* ëª¨ë‹¬ì°½ ìˆ˜ì •ì‚­ì œ ìœ„ì¹˜ ì´ìƒí•˜ê²Œ ë˜ì„œ ìœ„ì¹˜ ì¡°ì • */
/* ìˆ˜ì • ì‚­ì œ ì•„ì´ì½˜ ë° ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìœ„ì¹˜ ì¡°ì • */
.modal-content .edit-delete-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 9999; /* ë‹¤ë¥¸ ë‚´ìš© ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì • */
}

.modal-content .dropdown-menu {
    min-width: auto; /* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì˜ ìµœì†Œ ë„ˆë¹„ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì • */
    right: 0; /* ì•„ì´ì½˜ ì˜¤ë¥¸ìª½ì— ì •ë ¬ */
    left: auto;
    top: 30px; /* ìˆ˜ì • ì‚­ì œ ì•„ì´ì½˜ ì•„ë˜ì— í‘œì‹œë˜ë„ë¡ ì¡°ì • */
}

/* ë“œë¡­ë‹¤ìš´ ì•„ì´í…œì˜ ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ì‚¬ì´ì˜ ì—¬ë°±ì„ ì¡°ì • */
.modal-content .dropdown-menu .dropdown-item i {
    margin-right: 5px;
}
/* ê²Œì‹œë¬¼ ë‚´ìš©ì´ 3ì¤„ ì´ìƒì¸ ê²½ìš°ì—ë§Œ ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ í‘œì‹œ */
.post-body.collapsed {
  max-height: 60px; /* ìµœëŒ€ ë†’ì´ ì„¤ì • */
  overflow: hidden; /* ì´ˆê³¼ ë‚´ìš© ìˆ¨ê¹€ */
}
/* ------------------------------------------------------ */
  #comment-text {
    resize: none;
}

/* ------------------ */
/* ëŒ“ê¸€ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
.comment-section {
    margin-top: 20px;
}

/* ëŒ“ê¸€ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
.comment-container {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 10px;
}

/* ëŒ“ê¸€ í—¤ë” ìŠ¤íƒ€ì¼ */
.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

/* ì‚¬ìš©ì ì´ë¦„ ìŠ¤íƒ€ì¼ */
.comment-header h6 {
    margin: 0;
    font-size: 18px;
    font-weight: bold;
}

/* ëŒ“ê¸€ ë‚´ìš© ìŠ¤íƒ€ì¼ */
.comment-container p {
    margin-bottom: 10px;
    font-size: 16px;
}

/* ì¢‹ì•„ìš” ë²„íŠ¼ ë° ê°œìˆ˜ ìŠ¤íƒ€ì¼ */
.like-count {
    font-size: 14px;
    color: #777;
    margin-right: 10px;
}

.like-btn {
    background-color: transparent;
    border: none;
    cursor: pointer;
    outline: none;
}

/* ì‘ì„±ì¼ ë° ìˆ˜ì • ì—¬ë¶€ ìŠ¤íƒ€ì¼ */
.comment-date {
    font-size: 12px;
    color: #999;
}

/* ì¢‹ì•„ìš” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.like-btn i {
    font-size: 18px;
    margin-right: 5px;
}

/* ë“œë¡­ë‹¤ìš´ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
.edit-delete-icon {
    color: #777;
    cursor: pointer;
}

/* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
.dropdown-menu {
    min-width: 150px;
}

.dropdown-menu a {
    color: #333;
}

.dropdown-menu button {
    color: #333;
}

  /* ------------------ */
  .btn.dropdown-toggle::after {
  content: none; /* í™”ì‚´í‘œ ì œê±° */
  }
  .btn.dropdown-toggle::before {
  content: "..."; /* ì  ì„¸ ê°œ ì¶”ê°€ */
  font-size: 1.2rem; /* ì  ì„¸ ê°œ í¬ê¸° ì¡°ì • */
  color: #333; /* ì  ì„¸ ê°œ ìƒ‰ìƒ ì¡°ì • */
  }
  .edit-delete-buttons {
    position: absolute; /* ì ˆëŒ€ ìœ„ì¹˜ ì§€ì • */
    top: 35px; /* ìƒë‹¨ì—ì„œ n px ë–¨ì–´ì§„ ê³³ì— ìœ„ì¹˜ */
    right: 0px; /* ì˜¤ë¥¸ìª½ì—ì„œ n px ë–¨ì–´ì§„ ê³³ì— ìœ„ì¹˜ */
    z-index: 2; /* ì´ë¯¸ì§€ ìœ„ì— í‘œì‹œë˜ë„ë¡ z-index ì„¤ì • */
  }


  .edit-delete-buttons {
    float: right; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
    margin-top: -35px; /* ë²„íŠ¼ì„ ì¹´ë“œ ìƒë‹¨ ìª½ìœ¼ë¡œ ì˜®ê¸°ê¸° */
  }
  .custom-card {
    max-width: 600px; 
    margin: auto; 
  }
  .carousel-item .feed-image {
    object-fit: contain;
    width: 100%;
    height: 500px;
  }
  .carousel-item {
    transition: transform 1s ease, opacity 0.5s ease; 
  }
  .no-underline {
    text-decoration: none; 
  }
  .comment-container {
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 10px;
  }
  .comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
  }
  .comment-actions {
    display: flex;
    gap: 10px;
  }
  .comment-actions button {
    background-color: transparent;
    border: none;
    color: #888;
    cursor: pointer;
    font-size: 14px;
  }
  .carousel-control-next-icon,
  .carousel-control-prev-icon {
    filter: invert(1);
  }
</style>
<div class="container mt-5">
  <div class="card custom-card" style="position: relative;"> <!-- ìƒëŒ€ ìœ„ì¹˜ ì§€ì • -->
    {% if post.feed_images.all %}
      <div id="carouselExampleControls" class="carousel slide" data-bs-interval="false">
        <div class="carousel-inner">
          {% for image in post.feed_images.all %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <img src="{{ image.image.url }}" class="d-block w-100 feed-image" alt="...">
            </div>
          {% endfor %}
        </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
          </button>
        </div>
      {% endif %}
        

      <div class="card-body">
        <!-- ì•„ë˜ ì½”ë“œì—ì„œ post.user.id ë¥¼ post.user.pk ë¡œ ë³€ê²½ -->
        <h2><a href="{% url 'feed:view_user' pk=post.user.pk %}">{{ post.user.username }}</a></h2>
        <h2>{{ post.title }}</h2>
        <p class="mt-3">{{ post.body_text|linebreaksbr  }}</p> <!-- ìˆ˜ì • ì¤„ë°”ê¿ˆ í—ˆìš©-->
        
        <!-- ì¢‹ì•„ìš” ë²„íŠ¼ ìˆ˜ì • -->
        <a href="#" class="no-underline like-button" data-post="{{ post.id }}">
          {% if user in post.likes.all %}
            <span class="likes-count">â¤ï¸</span>
          {% else %}
            <span class="likes-count">ğŸ¤</span>
          {% endif %}
        </a>
        : <span class="likes-count">{{ post.likes.count }}</span>

        {% if post.content_type == 'review' and post.product %}
          <hr>
          <h5>ì œí’ˆ ë¦¬ë·°</h5>
          <p>ì œí’ˆëª…: {{ post.product.name }}</p>
          <p>íŒë§¤ì: {{ post.seller.username }}</p>
        {% endif %}
        
        <!-- ê²Œì‹œê¸€ì— ëŒ€í•œ ìˆ˜ì • ì‚­ì œ ë²„íŠ¼, ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í˜•íƒœë¡œ í‘œì‹œ -->
        {% if request.user == post.user or request.user.is_staff %}
        <div class="edit-delete-buttons">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
            </button>            
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
              <li><a class="dropdown-item" href="{% url 'feed:post_edit' post.pk %}">ìˆ˜ì •</a></li>
              <li>
                <form action="{% url 'feed:post_delete' post.id %}" method="post" style="display: inline;">
                  {% csrf_token %}
                  <button type="submit" class="dropdown-item">ì‚­ì œ</button>
                </form>
              </li>
            </ul>
          </div>
        </div>
        {% endif %}

<!-- -------------------------------------------------- -->

      <!-- ----------------- ëª¨ë‹¬ ì‚¬ìš©í•˜ì—¬ ìœ„ì ¯ ìƒì„±------------------------------  -->
      <div class="modal fade" id="commentWidgetModal" tabindex="-1" aria-labelledby="commentWidgetModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 800px;" > <!-- ëª¨ë‹¬ì°½ í¬ê¸°-->
          <div class="modal-content " style="max-height: 800px; overflow-y: auto;" > <!-- ëª¨ë‹¬ì°½ ìŠ¤í¬ë¡¤ -->
            <div class="modal-header">
              <h5 class="modal-title" id="commentWidgetModalLabel">ëŒ“ê¸€({{comments_count}})</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card-body">
                    <h2><a href="{% url 'feed:view_user' post.user.id %}">{{ post.user.username }}</a></h2>
                    <h2>{{ post.title }}</h2>
                    <p class="mt-3 post-body collapsed">{{ post.body_text|linebreaksbr }}</p> <!-- ìˆ˜ì • ì¤„ë°”ê¿ˆ í—ˆìš©-->
                    <!-- ê²Œì‹œë¬¼ ë‚´ìš©ì˜ ë”ë³´ê¸° ë²„íŠ¼ (ì•„ì´ì½˜: â–¾) -->
                    <button class="btn btn-sm btn-secondary expand-button">&#x25BE;</button>
                    <!-- ê²Œì‹œë¬¼ ë‚´ìš©ì˜ ì ‘ê¸° ë²„íŠ¼ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê²¨ë‘ , ì•„ì´ì½˜: â–´) -->
                    <button class="btn btn-sm btn-secondary collapse-button" style="display: none;">&#x25B4;</button>
                                        

                    {% if post.content_type == 'review' and post.product %}
                        <hr>
                        <h5>ì œí’ˆ ë¦¬ë·°</h5>
                        <p>ì œí’ˆëª…: {{ post.product.name }}</p>
                        <p>íŒë§¤ì: {{ post.seller.username }}</p>
                    {% endif %}
                </div>
                <div class="card-footer text-muted">
                    <p> {{ post.created_at|date:"Y-m-d H:i" }} </p>
                  </div>
                </div>
              <!-- ëŒ“ê¸€ ì „ì²´ í‘œì‹œ -->
              <div class="modal-header">
                <h5 class="modal-title">ëŒ“ê¸€ ì…ë ¥</h5>
                
            </div>
            <div class="modal-body">
              <form id="comment-form" action="{% url 'feed:comments_create' post.id %}" method="post" onsubmit="submitComment(event)">
                {% csrf_token %}
                <textarea class="form-control" id="comment-text" name="comment_text" rows="3" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                <button type="submit" class="btn btn-primary mt-3">ì‘ì„±</button>
            </form>
          </div>
            

<!-- ëŒ“ê¸€ë“¤ -->

<div class="comment-section">
  {% if most_liked_comment %}
  <!-- ìµœê³  ì¢‹ì•„ìš”ë¥¼ ë°›ì€ ëŒ“ê¸€ -->
  <div class="comment-container">
      <div class="comment-header d-flex justify-content-between align-items-center">
          <div>
              <h6>{{ most_liked_comment.user.username }}</h6>
              <p>{{ most_liked_comment.comment_text|linebreaksbr }}</p> <!-- ìˆ˜ì • ì¤„ë°”ê¿ˆ í—ˆìš©-->
              <div class="row align-items-center">
                  <div class="col-auto">
                      <button class="like-btn btn-primary" data-comment-id="{{ most_liked_comment.pk }}">
                          {% if request.user.is_authenticated %}
                              {% if request.user in most_liked_comment.likes.all %}
                                  <i class="fas fa-heart text-danger"></i> <!-- ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²½ìš° -->
                              {% else %}
                                  <i class="far fa-heart text-secondary"></i> <!-- ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì§€ ì•Šì€ ê²½ìš° -->
                              {% endif %}
                          {% else %}
                              <i class="far fa-heart text-secondary"></i> <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° -->
                          {% endif %}
                      </button>
                  </div>
                  <div class="col-auto">
                      <span class="like-count">ì¢‹ì•„ìš”({{ most_liked_comment.likes.count }})</span> <!-- ì¢‹ì•„ìš” ê°œìˆ˜ í‘œì‹œ -->
                  </div>
              </div>
              <div class="comment-date">
                  <p>{{ most_liked_comment.created_at }}
                      {% if most_liked_comment.created_at != most_liked_comment.updated_at %}
                          (ìˆ˜ì •ë¨)
                      {% endif %}
                  </p>
              </div>
          </div>
          <div class="comment-actions">
            {% if request.user == most_liked_comment.user or request.user.is_staff %}
              <div class="dropdown">
                  <button class="btn btn-link dropdown-toggle-1 p-0 edit-delete-icon" type="button" id="dropdownMenuButton{{ most_liked_comment.pk }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-ellipsis-v fa-lg"></i>
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton{{ most_liked_comment.pk }}">
                      {% if request.user == most_liked_comment.user or request.user.is_staff %}
                      <form action="{% url 'feed:comments_delete' most_liked_comment.pk %}" method="post" class="d-inline">
                          {% csrf_token %}
                          <button type="submit" class="dropdown-item trash-icon"><i class="fas fa-trash-alt fa-lg"></i> ì‚­ì œ</button>
                      </form>
                      {% endif %}
                      {% if request.user == most_liked_comment.user or request.user.is_staff %}
                      <a href="{% url 'feed:comments_update' most_liked_comment.pk %}" class="dropdown-item edit-icon"><i class="fas fa-edit fa-lg"></i> ìˆ˜ì •</a>
                      {% endif %}
                  </div>
              </div>
            {% endif %}
          </div>
      </div>
      
  </div>
  {% else %}
  <!-- ëŒ“ê¸€ì´ ì—†ì„ ë•Œ í‘œì‹œ -->
  <p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}

  <!-- ë‚˜ë¨¸ì§€ ëŒ“ê¸€ë“¤ -->
  {% for comment in other_comments %}
  <div class="comment-container">
      <div class="comment-header d-flex justify-content-between align-items-center">
          <div>
              <h6>{{ comment.user.username }}</h6>
              <p>{{ comment.comment_text|linebreaksbr }}</p> <!-- ìˆ˜ì • ì¤„ë°”ê¿ˆ í—ˆìš©-->
              <div class="row align-items-center">
                  <div class="col-auto">
                      <button class="like-btn" data-comment-id="{{ comment.pk }}">
                          {% if request.user.is_authenticated %}
                              {% if request.user in comment.likes.all %}
                                  <i class="fas fa-heart text-danger"></i> <!-- ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²½ìš° -->
                              {% else %}
                                  <i class="far fa-heart text-secondary"></i> <!-- ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì§€ ì•Šì€ ê²½ìš° -->
                              {% endif %}
                          {% else %}
                              <i class="far fa-heart text-secondary"></i> <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° -->
                          {% endif %}
                      </button>
                  </div>
                  <div class="col-auto">
                      <span class="like-count">ì¢‹ì•„ìš”({{ comment.likes.count }})</span> <!-- ì¢‹ì•„ìš” ê°œìˆ˜ í‘œì‹œ -->
                  </div>
              </div>
              <div class="comment-date">
                  <p>{{ comment.created_at }}
                      {% if comment.created_at != comment.updated_at %}
                          (ìˆ˜ì •ë¨)
                      {% endif %}
                  </p>
              </div>
          </div>
          <div class="comment-actions">
            {% if request.user == comment.user or request.user.is_staff %}            
              <div class="dropdown">
                  <button class="btn btn-link dropdown-toggle-1 p-0 edit-delete-icon" type="button" id="dropdownMenuButton{{ comment.pk }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-ellipsis-v fa-lg"></i>
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton{{ comment.pk }}">
                      {% if request.user == comment.user or request.user.is_staff %}
                      <form action="{% url 'feed:comments_delete' comment.pk %}" method="post" class="d-inline">
                          {% csrf_token %}
                          <button type="submit" class="dropdown-item trash-icon"><i class="fas fa-trash-alt fa-lg"></i> ì‚­ì œ</button>
                      </form>
                      {% endif %}
                      {% if request.user == comment.user or request.user.is_staff %}
                      <a href="{% url 'feed:comments_update' comment.pk %}" class="dropdown-item edit-icon"><i class="fas fa-edit fa-lg"></i> ìˆ˜ì •</a>
                      {% endif %}
                  </div>
              </div>
            {% endif %}
          </div>
      </div>
      
  </div>
  {% endfor %}
</div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- ----------------- ëª¨ë‹¬ ìƒì„± ë ------------------------------  -->

      <!-- ê²Œì‹œê¸€ ëŒ“ê¸€ì—ì„œ ì¢‹ì•„ìš”ê°€ ë§ì€ ëŒ“ê¸€ë§Œ í‘œì‹œ -->
  {% if most_liked_comment %}
  <!-- ìµœê³  ì¢‹ì•„ìš”ë¥¼ ë°›ì€ ëŒ“ê¸€ -->
  <div class="comment-container">
      <div class="comment-header d-flex justify-content-between align-items-center">
          <div>
              <h6>{{ most_liked_comment.user.username }}</h6>
              <p>{{ most_liked_comment.comment_text|linebreaksbr }}</p> <!-- ìˆ˜ì • ì¤„ë°”ê¿ˆ í—ˆìš©-->
              <div class="row align-items-center">
                  <div class="col-auto">
                      <button class="like-btn btn-primary" data-comment-id="{{ most_liked_comment.pk }}">
                          {% if request.user.is_authenticated %}
                              {% if request.user in most_liked_comment.likes.all %}
                                  <i class="fas fa-heart text-danger"></i> <!-- ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²½ìš° -->
                              {% else %}
                                  <i class="far fa-heart text-secondary"></i> <!-- ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì§€ ì•Šì€ ê²½ìš° -->
                              {% endif %}
                          {% else %}
                              <i class="far fa-heart text-secondary"></i> <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° -->
                          {% endif %}
                      </button>
                  </div>
                  <div class="col-auto">
                      <span class="like-count">ì¢‹ì•„ìš”({{ most_liked_comment.likes.count }})</span> <!-- ì¢‹ì•„ìš” ê°œìˆ˜ í‘œì‹œ -->
                  </div>
              </div>
              <div class="comment-date">
                  <p>{{ most_liked_comment.created_at }}
                      {% if most_liked_comment.created_at != most_liked_comment.updated_at %}
                          (ìˆ˜ì •ë¨)
                      {% endif %}
                  </p>
              </div>
          </div>
          <div class="comment-actions">
            {% if request.user == most_liked_comment.user or request.user.is_staff %}
              <div class="dropdown">
                  <button class="btn btn-link dropdown-toggle-1 p-0 edit-delete-icon" type="button" id="dropdownMenuButton{{ most_liked_comment.pk }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-ellipsis-v fa-lg"></i>
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton{{ most_liked_comment.pk }}">
                      {% if request.user == most_liked_comment.user or request.user.is_staff %}
                      <form action="{% url 'feed:comments_delete' most_liked_comment.pk %}" method="post" class="d-inline">
                          {% csrf_token %}
                          <button type="submit" class="dropdown-item trash-icon"><i class="fas fa-trash-alt fa-lg"></i> ì‚­ì œ</button>
                      </form>
                      {% endif %}
                      {% if request.user == most_liked_comment.user or request.user.is_staff %}
                      <a href="{% url 'feed:comments_update' most_liked_comment.pk %}" class="dropdown-item edit-icon"><i class="fas fa-edit fa-lg"></i> ìˆ˜ì •</a>
                      {% endif %}
                  </div>
              </div>
            {% endif %}
          </div>
      </div>
      
  </div>
  {% else %}
  <!-- ëŒ“ê¸€ì´ ì—†ì„ ë•Œ í‘œì‹œ -->
  <p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}

      

      <!-- ë”ë³´ê¸° ë²„íŠ¼ -->
      <div class="bg_lm">
        <button type="button" class="bg_lp btn btn-light border" aria-label="ëŒ“ê¸€ ë³´ëŸ¬ ê°€ê¸°" data-bs-toggle="modal" data-bs-target="#commentWidgetModal">
          <div class="bg_c7 t5">ëŒ“ê¸€ ({{ comments_count }})ê°œ ë³´ê¸°</div>
        </button>
      </div>
      
    </div>
  </div>
</div>
<!-- --------------------------------------------------------------------------- -->
<script>
// Djangoì—ì„œ ì œê³µí•˜ëŠ” CSRF í† í° ê°€ì ¸ì˜¤ê¸°
const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

document.addEventListener("DOMContentLoaded", function(){
  const likeButtons = document.querySelectorAll('.like-button');
  
  likeButtons.forEach(button => {
    button.addEventListener('click', function(e){
      e.preventDefault();
      const postId = this.dataset.post; 
      console.log(csrftoken);

      fetch(`{%url "feed:like-content" post.id%}`, {
        method: 'POST',
        
        headers: {
          'X-CSRFToken': csrftoken,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          'postId': postId,
        })
      })
      .then(response => response.json())
      .then(data => {
        const likeButton = this;
        const likesCountElement = likeButton.querySelector('.likes-count');
        likesCountElement.innerText = data.is_liked ? 'â¤ï¸' : 'ğŸ¤';
        likeButton.nextElementSibling.innerText = data.likes_count;
      })
      .catch((error) => {
        console.error('Error:', error);
      });
    });
  });
});
</script>
<!-- -------------------------------------------------------------------------------------- -->
<!-- AJAXë¥¼ ì‚¬ìš©í•˜ì—¬ ì¢‹ì•„ìš” ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ì²˜ë¦¬í•˜ëŠ” JavaScript ì½”ë“œ -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
    document.querySelectorAll('.like-btn').forEach(function(button) {
      button.addEventListener('click', function() {
        var commentId = this.getAttribute('data-comment-id');
        var likeCount = this.closest('.row').querySelector('.like-count');
        var heartIcon = this.querySelector('i'); // í•˜íŠ¸ ì•„ì´ì½˜

        // AJAXë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¡œ ì¢‹ì•„ìš” ìš”ì²­ì„ ë³´ëƒ„
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/feed/comment_like/' + commentId + '/');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
        xhr.onload = function() {
          if (xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            // ì„œë²„ë¡œë¶€í„° ì¢‹ì•„ìš” ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë°›ìœ¼ë©´ ì¢‹ì•„ìš” ìˆ«ìë¥¼ ì—…ë°ì´íŠ¸
            likeCount.textContent ='ì¢‹ì•„ìš”(' + response.likes_count + ')';

            // ì¢‹ì•„ìš” ë²„íŠ¼ì˜ ì•„ì´ì½˜ ë³€ê²½
            if (response.liked) {
              heartIcon.classList.remove('far'); // ë¹ˆ í•˜íŠ¸ í´ë˜ìŠ¤ ì œê±°
              heartIcon.classList.add('fas');  // ì±„ì›Œì§„ í•˜íŠ¸ í´ë˜ìŠ¤ ì¶”ê°€
              heartIcon.classList.add('text-danger'); // í•˜íŠ¸ ìƒ‰ìƒ ë³€ê²½
            } else {
              heartIcon.classList.remove('fas'); // ì±„ì›Œì§„ í•˜íŠ¸ í´ë˜ìŠ¤ ì œê±°
              heartIcon.classList.add('far');  // ë¹ˆ í•˜íŠ¸ í´ë˜ìŠ¤ ì¶”ê°€
              heartIcon.classList.remove('text-danger'); // í•˜íŠ¸ ìƒ‰ìƒ ì œê±°
            }
          } else {
            console.error('Request failed. Error: ' + xhr.status);
          }
        };
        xhr.send(JSON.stringify({}));
      });
    });
  });
</script>
<!-- ê²Œì‹œë¬¼ 3ì¤‘ì´ìƒ ë”ë³´ê¸°/ì ‘ê¸° -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // ê²Œì‹œê¸€ ë‚´ìš© ìš”ì†Œ
      var postBody = document.querySelector('.post-body');
      // ê²Œì‹œê¸€ ë‚´ìš©ì˜ ë†’ì´
      var postBodyHeight = postBody.clientHeight;
      // ê¸°ë³¸ ìµœëŒ€ ë†’ì´ (3ì¤„ë¡œ ì„¤ì •)
      var maxHeight = 60;

      // ê²Œì‹œê¸€ ë‚´ìš©ì´ ìµœëŒ€ ë†’ì´ë³´ë‹¤ í´ ê²½ìš° ë”ë³´ê¸° ë²„íŠ¼ í‘œì‹œ
      if (postBodyHeight > maxHeight) {
          // ìµœëŒ€ ë†’ì´ ì„¤ì •
          postBody.style.maxHeight = maxHeight + 'px';
          // ë”ë³´ê¸° ë²„íŠ¼ í‘œì‹œ
          document.querySelector('.expand-button').style.display = 'block';
      }

      // ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
      var expandButton = document.querySelector('.expand-button');
      var collapseButton = document.querySelector('.collapse-button');

      expandButton.addEventListener('click', function() {
          // ìµœëŒ€ ë†’ì´ í•´ì œ
          postBody.style.maxHeight = 'none';
          // ë”ë³´ê¸° ë²„íŠ¼ ì•„ì´ì½˜ ë³€ê²½
          expandButton.innerHTML = '&#x25B4;'; // â–´ ì•„ì´ì½˜
          // ë”ë³´ê¸° ë²„íŠ¼ ìˆ¨ê¹€
          expandButton.style.display = 'none';
          // ì ‘ê¸° ë²„íŠ¼ í‘œì‹œ
          collapseButton.style.display = 'block';
      });

      collapseButton.addEventListener('click', function() {
          // ìµœëŒ€ ë†’ì´ ì¬ì„¤ì •
          postBody.style.maxHeight = maxHeight + 'px';
          // ë”ë³´ê¸° ë²„íŠ¼ ì•„ì´ì½˜ ë³€ê²½
          expandButton.innerHTML = '&#x25BE;'; // â–¾ ì•„ì´ì½˜
          // ì ‘ê¸° ë²„íŠ¼ ìˆ¨ê¹€
          collapseButton.style.display = 'none';
          // ë”ë³´ê¸° ë²„íŠ¼ í‘œì‹œ
          expandButton.style.display = 'block';
      });
  });
</script>

  

    <!-- ìˆ˜ì •,ì‚­ì œ ...ì•„ì´ì½˜ì— ë„£ê¸° -->
<script>
  // ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
  document.addEventListener('DOMContentLoaded', function() {
      var editDeleteIcons = document.querySelectorAll('.edit-delete-icon');
      editDeleteIcons.forEach(function(icon) {
          icon.addEventListener('click', function(event) {
              event.stopPropagation(); // ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€

              // í˜„ì¬ í´ë¦­í•œ ì•„ì´ì½˜ì˜ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¥¼ í† ê¸€
              var dropdownMenu = this.nextElementSibling;
              if (dropdownMenu.style.display === 'none' || dropdownMenu.style.display === '') {
                  dropdownMenu.style.display = 'block';
              } else {
                  dropdownMenu.style.display = 'none';
              }
          });
      });
  });
</script>
<script>
  function validateComment() {
      var commentText = document.getElementById('comment-text').value.trim();
      if (commentText === '') {
          alert('ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.');
          return false;  // ëŒ“ê¸€ì´ ë¹„ì–´ìˆìœ¼ë©´ ì „ì†¡ì„ ì¤‘ì§€í•˜ê³  ì•Œë¦¼ì„ í‘œì‹œí•©ë‹ˆë‹¤.
      }
      return true;  // ëŒ“ê¸€ì´ ì‘ì„±ë˜ì—ˆìœ¼ë©´ ì „ì†¡ì„ ê³„ì†í•©ë‹ˆë‹¤.
  }
</script>
<!-- ---------------------------------------------------------------- -->



{% endblock %}
