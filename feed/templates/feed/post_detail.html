{% extends 'base.html' %}

{% block content %}
<style>
  .custom-card {
    max-width: 600px; 
    margin: auto; 
  }
  .feed-image {
    object-fit: contain; /* ë³€ê²½ëœ ë¶€ë¶„ */
    width: 100%; /* ì¶”ê°€ëœ ë¶€ë¶„ */
    height: 500px;
  }
  .carousel-item {
    transition: transform 1s ease, opacity 0.5s ease; 
  }
  .no-underline {
    text-decoration: none; 
  }
  /* ëŒ“ê¸€ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
  .comment-container {
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 10px;
  }
  .comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
  }
  .comment-header h6 {
    margin: 0;
  }
  .comment-actions {
    display: flex;
    gap: 10px;
  }
  .comment-actions button {
    background-color: transparent;
    border: none;
    color: #888;
    cursor: pointer;
    font-size: 14px;
  }
  /* í™”ì‚´í‘œ ìƒ‰ìƒ ë³€ê²½ */
  .carousel-control-next-icon,
  .carousel-control-prev-icon {
    filter: invert(1); /* í°ìƒ‰ì—ì„œ ê²€ì •ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
  }
</style>
<div class="container mt-5">
    <div class="card custom-card">
      {% if post.feed_images.all %}
        <div id="carouselExampleControls" class="carousel slide" data-bs-interval="false">
          <div class="carousel-inner">
            {% for image in post.feed_images.all %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <img src="{{ image.image.url }}" class="d-block w-100 feed-image" alt="...">
              </div>
            {% endfor %}
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      {% endif %}
        
      <div class="card-body">
        <h2>{{ post.user.username }}</h2>
        <h2>{{ post.title }}</h2>
        <p class="mt-3">{{ post.body_text }}</p>


        {% if user in post.likes.all %}
          <a href="{% url 'feed:like_content' post.id %}" class="no-underline">â¤ï¸</a>
        {% else %}
          <a href="{% url 'feed:like_content' post.id %}" class="no-underline">ğŸ¤</a>
        {% endif %}
        : {{ post.likes.count }}


        {% if post.content_type == 'review' and post.product %}
          <hr>
          <h5>ì œíˆ¼ ë¦¬ë·°</h5>
          <p>ì œíˆ¼ëª…: {{ post.product.name }}</p>
          <p>íŒë§¤ì: {{ post.seller.username }}</p>
        {% endif %}
      </div>
      <div class="card-footer text-muted">
        <p> {{ post.created_at|date:"Y-m-d H:i" }} </p>
      </div>

      <div class="card-footer">
        <h5>ëŒ“ê¸€</h5>
        {% for comment in post.comment_set.all %}
        <div class="comment-container">
          <div class="comment-header">
            <h6>{{ comment.user.username }}</h6>
            <div class="comment-actions">
              <p>{{ comment.created_at }}</p>
              {% if request.user == comment.user or request.user.is_staff %}
              <form action="{% url 'feed:comments_delete' comment.pk %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit">ì‚­ì œ</button>
              </form>
              {% endif %}
            </div>
          </div>
          <p>{{ comment.comment_text }}</p>
        </div>
        {% empty %}
        <p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
        
        <form action="{% url 'feed:comments_create' post.id %}" method="post">
          {% csrf_token %}
          {{ commentform }}
          <button type="submit" class="btn btn-primary">ì‘ì„±</button>
        </form>
      </div>
    </div>
</div>
{% endblock %}
